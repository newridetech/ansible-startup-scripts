- hosts: all
  become_user: root

  pre_tasks:
    - name: Install roles from Ansible Galaxy
      command: ansible-galaxy install {{ item }}
      with_items:
        - "benjamin-smith.ondrej-php-repo"
        - "geerlingguy.mysql"
        - "dev-sec.mysql-hardening"
        - "jdauphant.nginx"
        - "dev-sec.nginx-hardening"
        - "geerlingguy.php-versions"
        - "geerlingguy.php"
        - "geerlingguy.composer"
        - "geerlingguy.nodejs"
        - "ocha.yarn"
        - "franklinkim.environment"

  roles:
    - role: franklinkim.environment
  vars:
    environment_config:
      APP_DOMAIN: "{{ lookup('env','APP_DOMAIN') }}"
      DB_DATABASE: "{{ lookup('env','DB_DATABASE') }}"
      DB_USERNAME: "{{ lookup('env','DB_USERNAME') }}"
      DB_PASSWORD: "{{ lookup('env','DB_PASSWORD') }}"
      DB_ROOT_PASSWORD: "{{ lookup('env','DB_ROOT_PASSWORD') }}"